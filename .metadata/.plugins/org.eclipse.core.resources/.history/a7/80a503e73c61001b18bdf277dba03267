package kr.or.ddit.mvc.controller;

import java.util.List;
import java.util.Scanner;

import kr.or.ddit.mvc.service.IMemberService;
import kr.or.ddit.mvc.service.MemberServicelmpl;
import kr.or.ddit.mvc.vo.MemberVO;

public class MemberController {
   private Scanner sc = new Scanner(System.in);
   
   //controller는 service객체를 사용하기 때문에
   //service객체게 저장될 변수가 필요하다.
   private IMemberService service;
   
   public MemberController() {
      service = new MemberServicelmpl();
      
}
   
   public static void main(String[] args) {

      new MemberController().memberStart();
      
      
   }
   
   public void memberStart(){
      while(true){
         int choice = displayMenu();
         
         switch (choice) {
         case 1://추가
            insertMember();
            
            break;
         
         case 2://삭제
            deleteMember();
            
            break;
         
         case 3://수정
            updateMember();
            break;

         case 4://전체 출력
            displayMember();
            break;
            
         case 5 : //자려수정2
           // updateMember2();

         case 0://작업종료
            System.out.println("작업을 마칩니다.");
            /*System.exit(0);*/
            return;
         
         default:
            System.out.println("번호를 잘못 입력했습니다.");
         }
      }
   }
   
   

   //메뉴 출력 및 작업번호를 입력받아 반환하는 메서드
   private int displayMenu(){
      System.out.println();
      System.out.println("--------------- 작업 선택  ---------------");
      System.out.println("1. 자료추가");
      System.out.println("2. 자료삭제");
      System.out.println("3. 자료수정");
      System.out.println("4. 전체자료출력");
      System.out.println("5. 자료수정 2"); //원하는 항목 하나만 수정
      System.out.println("0. 작업종료");
      System.out.println("--------------------------------------");
      System.out.println("작업선택 >>");
      int num = Integer.parseInt(sc.nextLine());
      
      return num;
   }
   
   //회원 정보를 수정하는 매서드(원하는 컬럼 한가지만 수정한다)
  /* private void updateMember2(){

      Connection conn = null;
      PreparedStatement ps = null;
      
      System.out.println("");
      System.out.println("수정할 회원정보를 입력하세요");
      
      System.out.println("회원ID>>");
      String memId = sc.nextLine();
      
      int count = getMemberCount(memId);
      
      if(count == 0){
         System.out.println(memId + "회원은 없는 회원 ID입니다");
         System.out.println("수정작업을 마칩니다");
         return;
      }else{
         System.out.println("수정하고 싶은 항목 번호를 눌러주세요");
         System.out.println("1.이름 2.전화번호 3.회원주소 4.돌아가기");
         int input = sc.nextInt();
         switch(input){
         case 1 :
            System.out.println("새로운 회원이름>");
            String memName = sc.next();
            
            try {
               conn = DBUtil.getConnection();
               
               String sql = "UPDATE MYMEMBER SET "
                           +"MEM_NAME = ? "
                           +"WHERE MEM_ID = ?";
               ps = conn.prepareStatement(sql);
               ps.setString(1, memName);
               ps.setString(2, memId);
               
               int cnt = ps.executeUpdate();
               if(cnt > 0){
                  System.out.println("이름수정 성공!");
               }else{
                  System.out.println("이름 수정 실패");
               }
               
         } catch (SQLException e) {
            e.printStackTrace();
         } finally{
            if(conn != null) try{conn.close();} catch(SQLException e){}
               if(ps != null) try{ps.close();} catch(SQLException e){}
         }
            return;
            
         case 2 : 
            System.out.println("새로운 전화번호");
            String memTel1 = sc.next();
            
            try {
               conn = DBUtil.getConnection();
               
               String sql = "UPDATE MYMEMBER SET "
                           +"MEM_TEL = ? "
                           +"WHERE MEM_ID = ?";
               ps = conn.prepareStatement(sql);
               ps.setString(1, memTel1);
               ps.setString(2, memId);
               
               int cnt = ps.executeUpdate();
               if(cnt>0){
                  System.out.println("전화번호 수정 성공");
               }else{
                  System.out.println("전화번호 수정 실패");
               }
            
         } catch (SQLException e) {
            e.printStackTrace();
         }finally{
            if(conn != null) try{conn.close();} catch(SQLException e){}
               if(ps != null) try{ps.close();} catch(SQLException e){}
         }
            return;
         case 3 :
            System.out.println("새로운 주소");
            String memAddr = sc.next();
            
            try {
               conn = DBUtil.getConnection();
               
               String sql = "UPDATE MYMEMBER SET "
                           +"MEM_TEL = ? "
                           +"WHERE MEM_ID = ?";
               ps = conn.prepareStatement(sql);
               ps.setString(1, memAddr);
               ps.setString(2, memId);
               
               int cnt = ps.executeUpdate();
               if(cnt>0){
                  System.out.println("전화번호 수정 성공");
               }else{
                  System.out.println("전화번호 수정 실패");
               }
            
         } catch (SQLException e) {
            e.printStackTrace();
         }finally{
            if(conn != null) try{conn.close();} catch(SQLException e){}
               if(ps != null) try{ps.close();} catch(SQLException e){}
         }
            return;
            
         case 4 : return;
         
         }
         
         
      }
      
   }
   */
   
   
   //회원 정보를 추가하는 메서드------------------------------------------
   private void insertMember() {
      
      System.out.println();
      System.out.println("추가할 회원정보를 입력하세요.");
      
      int count = 0;
      String memId; //입력한 회원ID가 저장될 변수
      
      do{
         System.out.println("회원ID >> ");
         memId = sc.nextLine();
         
         count = service.getMemberCount(memId);
         if(count > 0){
            System.out.println("회원ID가 " + memId + "인 회원은 이미 존재 합니다.");
            System.out.println("다른 ID로 다시 입력하세요.");
            System.out.println();
         }
      }while(count > 0);
      System.out.println("회원이름 >> ");
      String memName = sc.nextLine();
      System.out.println("전화번호>>");
      String memTel = sc.nextLine();
      System.out.println("주소>>");
      String memAddr = sc.nextLine();
      
      //service로 보낼 memberVO객체를 생성하고 입력한 자료를 셋팅한다.
      MemberVO memVo = new MemberVO();
      memVo.setMem_id(memId);
      memVo.setMem_name(memName);
      memVo.setMem_tel(memTel);
      memVo.setMem_addr(memAddr);
      //service의 insert하는 매서드 호출
      int cnt = service.insertMember(memVo);
      
      if(cnt>0){
         System.out.println("insert 성공");
      }else{
         System.out.println("insert 실패");
      }
   }
 //-전체 회원 정보를 출력하는 메서드----------------------------------------------------------------------------  
   

   private void displayMember(){
      List<MemberVO> memList = 
    		  	service.getAllMember();
      System.out.println();
      System.out.println("-----------------------------------------");
      System.out.println("ID      이름        전화번호         주소");
      System.out.println("-----------------------------------------");
      if(memList==null || memList.size()==0){
    	  System.out.println("등록된 회원이 하나도 없습니다..");
      }else{
    	  for(MemberVO memVo : memList){
    		  System.out.print(memVo.getMem_id()+"\t");
    		  System.out.print(memVo.getMem_name()+"\t");
    		  System.out.print(memVo.getMem_tel()+"\t");
    		  System.out.println(memVo.getMem_addr());
    		  
    	  }
      }
      
      System.out.println("------------------------------------------");
      System.out.println("출력 끝....");

   }
//회원정보를 삭제하는 메서드-------------------------------------------------------------------------------------
   private void deleteMember(){
      
      System.out.println();
      System.out.println("삭제할 회원정보를 입력해주세요.");
      System.out.println("삭제할 회원ID >>");
      String memId = sc.nextLine();
      
      int cnt = service.deleteMember(memId);
      
      if(cnt>0){
         System.out.println("insert 성공");
      }else{
         System.out.println("insert 실패");
      }
   }
 //---------------------------------------------------------------------------------  
   //회원정보를 수정하는 메서드
   private void updateMember(){
      
      System.out.println();
      System.out.println("수정할 회원 정보를 입력하세요..");
      
      System.out.print("회원ID >> ");
      String memId = sc.nextLine();
      
      //나머지 데이터를 입력하기 전에 memId가 있는지 확인한다.
      int count = service.getMemberCount(memId);
      
      if(count == 0){//없는 회원이면....
         System.out.println(memId + "회원은 없는 회원ID 입니다.");
         System.out.println("수정작업을 마칩니다.");
         return; // 메서드가 끝나게 된다.
      }
      
      System.out.print("새로운 회원이름>> ");
      String memName = sc.nextLine();
      
      System.out.println("새로운 회원 전화번호>>");
      String memTel = sc.nextLine();
      
      System.out.println("새로운 회원주소>>");
      String memAddr = sc.nextLine();
      
      //service로 보낼 memberVO객체를 생성하고 입력한 자료를 셋팅한다.
      MemberVO memVo = new MemberVO();
      memVo.setMem_id(memId);
      memVo.setMem_name(memName);
      memVo.setMem_tel(memTel);
      memVo.setMem_addr(memAddr);
      //service의 insert하는 매서드 호출
      int cnt = service.updateMember(memVo);
      
      if(cnt>0){
         System.out.println("insert 성공");
      }else{
         System.out.println("insert 실패");
      }
      
      

   
   }
   

}